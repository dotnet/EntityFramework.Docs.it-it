---
title: Regole di confronto e distinzione maiuscole/minuscole-EF Core
description: Configurazione delle regole di confronto e distinzione tra maiuscole e minuscole nel database e nelle query con Entity Framework Core
author: roji
ms.date: 04/27/2020
uid: core/miscellaneous/collations-and-case-sensitivity
ms.openlocfilehash: cced7e11f7bf02223d3f181677ad1707c1da4051
ms.sourcegitcommit: f3512e3a98e685a3ba409c1d0157ce85cc390cf4
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/10/2020
ms.locfileid: "94429741"
---
# <a name="collations-and-case-sensitivity"></a><span data-ttu-id="882d0-103">Regole di confronto e distinzione tra maiuscole e minuscole</span><span class="sxs-lookup"><span data-stu-id="882d0-103">Collations and Case Sensitivity</span></span>

> [!NOTE]
> <span data-ttu-id="882d0-104">Questa funzionalità è stata introdotta in EF Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="882d0-104">This feature is introduced in EF Core 5.0.</span></span>

<span data-ttu-id="882d0-105">L'elaborazione del testo nei database può essere complessa e richiede un maggior intervento da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="882d0-105">Text processing in databases can be a complex, and requires more user attention that one would suspect.</span></span> <span data-ttu-id="882d0-106">Per una cosa, i database variano notevolmente in base alla modalità di gestione del testo. ad esempio, mentre alcuni database fanno distinzione tra maiuscole e minuscole per impostazione predefinita (ad esempio SQLite, PostgreSQL), altri non fanno distinzione tra maiuscole e minuscole (SQL Server, MySQL).</span><span class="sxs-lookup"><span data-stu-id="882d0-106">For one thing, databases vary considerably in how they handle text; for example, while some databases are case-sensitive by default (e.g. Sqlite, PostgreSQL), others are case-insensitive (SQL Server, MySQL).</span></span> <span data-ttu-id="882d0-107">Inoltre, a causa dell'utilizzo di indici, la distinzione tra maiuscole e minuscole e gli aspetti simili possono avere un notevole effetto sulle prestazioni delle query: Sebbene sia possibile tentare di utilizzare per forzare un confronto senza distinzione tra maiuscole e minuscole in un database con distinzione tra maiuscole e minuscole `string.Lower` , questa operazione può impedire all'applicazione di utilizzare gli indici.</span><span class="sxs-lookup"><span data-stu-id="882d0-107">In addition, because of index usage, case-sensitivity and similar aspects can have a far-reaching impact on query performance: while it may be tempting to use `string.Lower` to force a case-insensitive comparison in a case-sensitive database, doing so may prevent your application from using indexes.</span></span> <span data-ttu-id="882d0-108">In questa pagina viene illustrato in dettaglio come configurare la distinzione tra maiuscole e minuscole, o più in generale, le regole di confronto e come eseguire questa operazione in modo efficiente senza compromettere le prestazioni delle query.</span><span class="sxs-lookup"><span data-stu-id="882d0-108">This page details how to configure case sensitivity, or more generally, collations, and how to do so in an efficient way without compromising query performance.</span></span>

## <a name="introduction-to-collations"></a><span data-ttu-id="882d0-109">Introduzione alle regole di confronto</span><span class="sxs-lookup"><span data-stu-id="882d0-109">Introduction to collations</span></span>

<span data-ttu-id="882d0-110">Un concetto fondamentale nell'elaborazione del testo sono le regole di *confronto* , ovvero un set di regole che determinano il modo in cui i valori di testo vengono ordinati e confrontati per verificare l'uguaglianza.</span><span class="sxs-lookup"><span data-stu-id="882d0-110">A fundamental concept in text processing is the *collation* , which is a set of rules determining how text values are ordered and compared for equality.</span></span> <span data-ttu-id="882d0-111">Se, ad esempio, le regole di confronto senza distinzione tra maiuscole e minuscole ignorano le differenze tra lettere maiuscole e minuscole ai fini del confronto di uguaglianza, non vengono applicate regole di confronto con distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="882d0-111">For example, while a case-insensitive collation disregards differences between upper- and lower-case letters for the purposes of equality comparison, a case-sensitive collation does not.</span></span> <span data-ttu-id="882d0-112">Tuttavia, poiché la distinzione tra maiuscole e minuscole è dipendente dalle impostazioni cultura (ad esempio `i` e `I` rappresenta una lettera diversa in turco), esistono più regole di confronto senza distinzione tra maiuscole e minuscole, ognuna con un proprio set di regole.</span><span class="sxs-lookup"><span data-stu-id="882d0-112">However, since case-sensitivity is culture-sensitive (e.g. `i` and `I` represent different letter in Turkish), there exist multiple case-insensitive collations, each with its own set of rules.</span></span> <span data-ttu-id="882d0-113">L'ambito delle regole di confronto si estende anche oltre la distinzione tra maiuscole e minuscole e altri aspetti dei dati di tipo carattere. in tedesco, ad esempio, è a volte, ma non sempre, auspicabile da trattare `ä` e `ae` come identico.</span><span class="sxs-lookup"><span data-stu-id="882d0-113">The scope of collations also extends beyond case-sensitivity, to other aspects of character data; in German, for example, it is sometimes (but not always) desirable to treat `ä` and `ae` as identical.</span></span> <span data-ttu-id="882d0-114">Infine, le regole di confronto definiscono anche il modo in cui vengono *ordinati* i valori di testo: mentre `ä` il tedesco si trova dopo `a` , lo svedese lo inserisce alla fine dell'alfabeto.</span><span class="sxs-lookup"><span data-stu-id="882d0-114">Finally, collations also define how text values are *ordered* : while German places `ä` after `a`, Swedish places it at the end of the alphabet.</span></span>

<span data-ttu-id="882d0-115">Tutte le operazioni di testo in un database utilizzano regole di confronto, in modo esplicito o implicito, per determinare il modo in cui l'operazione Confronta e ordina le stringhe.</span><span class="sxs-lookup"><span data-stu-id="882d0-115">All text operations in a database use a collation - whether explicitly or implicitly - to determine how the operation compares and orders strings.</span></span> <span data-ttu-id="882d0-116">L'elenco effettivo delle regole di confronto disponibili e i relativi schemi di denominazione sono specifici del database. consultare [la sezione seguente](#database-specific-information) per collegamenti a pagine di documentazione rilevanti di diversi database.</span><span class="sxs-lookup"><span data-stu-id="882d0-116">The actual list of available collations and their naming schemes is database-specific; consult [the section below](#database-specific-information) for links to relevant documentation pages of various databases.</span></span> <span data-ttu-id="882d0-117">Fortunatamente, il database in genere consente di definire regole di confronto predefinite a livello di database o di colonna e di specificare in modo esplicito le regole di confronto da utilizzare per operazioni specifiche in una query.</span><span class="sxs-lookup"><span data-stu-id="882d0-117">Fortunately, database do generally allow a default collation to be defined at the database or column level, and to explicitly specify which collation should be use for specific operations in a query.</span></span>

## <a name="database-collation"></a><span data-ttu-id="882d0-118">Regole di confronto del database</span><span class="sxs-lookup"><span data-stu-id="882d0-118">Database collation</span></span>

<span data-ttu-id="882d0-119">Nella maggior parte dei sistemi di database, le regole di confronto predefinite vengono definite a livello di database. a meno che non venga sottoposto a override, le regole di confronto si applicano in modo implicito a tutte le operazioni di testo che si verificano</span><span class="sxs-lookup"><span data-stu-id="882d0-119">In most database systems, a default collation is defined at the database level; unless overridden, that collation implicitly applies to all text operations occurring within that database.</span></span> <span data-ttu-id="882d0-120">Le regole di confronto del database vengono in genere impostate al momento della creazione del database (tramite l' `CREATE DATABASE` istruzione DDL). se non è specificato, il valore predefinito è un valore a livello di server determinato al momento dell'installazione.</span><span class="sxs-lookup"><span data-stu-id="882d0-120">The database collation is typically set at database creation time (via the `CREATE DATABASE` DDL statement), and if not specified, defaults to a some server-level value determined at setup time.</span></span> <span data-ttu-id="882d0-121">Ad esempio, le regole di confronto predefinite a livello di server in SQL Server sono `SQL_Latin1_General_CP1_CI_AS` , ovvero regole di confronto con distinzione tra maiuscole e minuscole e con distinzione tra caratteri accentati.</span><span class="sxs-lookup"><span data-stu-id="882d0-121">For example, the default server-level collation in SQL Server is `SQL_Latin1_General_CP1_CI_AS`, which is a case-insensitive, accent-sensitive collation.</span></span> <span data-ttu-id="882d0-122">Sebbene i sistemi di database consentano in genere di modificare le regole di confronto di un database esistente, questo può causare complicazioni. è consigliabile selezionare le regole di confronto prima della creazione del database.</span><span class="sxs-lookup"><span data-stu-id="882d0-122">Although database systems usually do permit altering the collation of an existing database, doing so can lead to complications; it is recommended to pick a collation before database creation.</span></span>

<span data-ttu-id="882d0-123">Quando si utilizzano migrazioni di EF Core per gestire lo schema del database, nel metodo del modello viene `OnModelCreating` configurato un database SQL Server per l'utilizzo di regole di confronto con distinzione tra maiuscole e minuscole:</span><span class="sxs-lookup"><span data-stu-id="882d0-123">When using EF Core migrations to manage your database schema, the following in your model's `OnModelCreating` method configures a SQL Server database to use a case-sensitive collation:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?range=40)]

## <a name="column-collation"></a><span data-ttu-id="882d0-124">Regole di confronto a livello di colonna</span><span class="sxs-lookup"><span data-stu-id="882d0-124">Column collation</span></span>

<span data-ttu-id="882d0-125">È inoltre possibile definire le regole di confronto per le colonne di testo, eseguendo l'override dell'impostazione predefinita del database.</span><span class="sxs-lookup"><span data-stu-id="882d0-125">Collations can also be defined on text columns, overriding the database default.</span></span> <span data-ttu-id="882d0-126">Questo può essere utile se alcune colonne non devono fare distinzione tra maiuscole e minuscole, mentre il resto del database deve fare distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="882d0-126">This can be useful if certain columns need to be case-insensitive, while the rest of the database needs to be case-sensitive.</span></span>

<span data-ttu-id="882d0-127">Quando si utilizzano migrazioni di EF Core per gestire lo schema del database, il codice seguente configura la colonna per la proprietà in modo che non venga fatta distinzione tra maiuscole e minuscole `Name` in un database che altrimenti è configurato per la distinzione tra maiuscole e minuscole:</span><span class="sxs-lookup"><span data-stu-id="882d0-127">When using EF Core migrations to manage your database schema, the following configures the column for the `Name` property to be case-insensitive in a database that is otherwise configured to be case-sensitive:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=OnModelCreating&highlight=6)]

## <a name="explicit-collation-in-a-query"></a><span data-ttu-id="882d0-128">Regole di confronto esplicite in una query</span><span class="sxs-lookup"><span data-stu-id="882d0-128">Explicit collation in a query</span></span>

<span data-ttu-id="882d0-129">In alcuni casi, è necessario eseguire query sulla stessa colonna utilizzando regole di confronto diverse in base a query diverse.</span><span class="sxs-lookup"><span data-stu-id="882d0-129">In some cases, the same column needs to be queried using different collations by different queries.</span></span> <span data-ttu-id="882d0-130">Ad esempio, una query potrebbe dover eseguire un confronto con distinzione tra maiuscole e minuscole in una colonna, mentre un altro potrebbe dover eseguire un confronto senza distinzione tra maiuscole e minuscole nella stessa colonna.</span><span class="sxs-lookup"><span data-stu-id="882d0-130">For example, one query may need to perform a case-sensitive comparison on a column, while another may need to perform a case-insensitive comparison on the same column.</span></span> <span data-ttu-id="882d0-131">Questa operazione può essere eseguita specificando in modo esplicito le regole di confronto all'interno della query stessa:</span><span class="sxs-lookup"><span data-stu-id="882d0-131">This can be accomplished by explicitly specifying a collation within the query itself:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=SimpleQueryCollation)]

<span data-ttu-id="882d0-132">Viene generata una `COLLATE` clausola nella query SQL che applica regole di confronto con distinzione tra maiuscole e minuscole, indipendentemente dalle regole di confronto definite a livello di colonna o di database:</span><span class="sxs-lookup"><span data-stu-id="882d0-132">This generates a `COLLATE` clause in the SQL query, which applies a case-sensitive collation regardless of the collation defined at the column or database level:</span></span>

```sql
SELECT [c].[Id], [c].[Name]
FROM [Customers] AS [c]
WHERE [c].[Name] COLLATE SQL_Latin1_General_CP1_CS_AS = N'John'
```

### <a name="explicit-collations-and-indexes"></a><span data-ttu-id="882d0-133">Regole di confronto esplicite e indici</span><span class="sxs-lookup"><span data-stu-id="882d0-133">Explicit collations and indexes</span></span>

<span data-ttu-id="882d0-134">Gli indici sono uno dei fattori più importanti nelle prestazioni del database. una query che viene eseguita in modo efficiente con un indice può frantumarsi senza tale indice.</span><span class="sxs-lookup"><span data-stu-id="882d0-134">Indexes are one of the most important factors in database performance - a query that runs efficiently with an index can grind to a halt without that index.</span></span> <span data-ttu-id="882d0-135">Gli indici ereditano in modo implicito le regole di confronto della colonna; Ciò significa che tutte le query sulla colonna sono automaticamente idonee per l'utilizzo di indici definiti nella colonna, purché la query non specifichi regole di confronto diverse.</span><span class="sxs-lookup"><span data-stu-id="882d0-135">Indexes implicitly inherit the collation of their column; this means that all queries on the column are automatically eligible to use indexes defined on that column - provided that the query doesn't specify a different collation.</span></span> <span data-ttu-id="882d0-136">La specifica di regole di confronto esplicite in una query in genere impedisce a tale query di utilizzare un indice definito in tale colonna, poiché le regole di confronto non corrispondono più. è quindi consigliabile prestare attenzione quando si usa questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="882d0-136">Specifying an explicit collation in a query will generally prevent that query from using an index defined on that column, since the collations would no longer match; it is therefore recommended to exercise caution when using this feature.</span></span> <span data-ttu-id="882d0-137">È sempre preferibile definire le regole di confronto a livello di colonna (o database), consentendo a tutte le query di utilizzare in modo implicito tali regole di confronto e trarre vantaggio da qualsiasi indice.</span><span class="sxs-lookup"><span data-stu-id="882d0-137">It is always preferable to define the collation at the column (or database) level, allowing all queries to implicitly use that collation and benefit from any index.</span></span>

<span data-ttu-id="882d0-138">Si noti che alcuni database consentono di definire le regole di confronto durante la creazione di un indice, ad esempio PostgreSQL, SQLite.</span><span class="sxs-lookup"><span data-stu-id="882d0-138">Note that some databases allow the collation to be defined when creating an index (e.g. PostgreSQL, Sqlite).</span></span> <span data-ttu-id="882d0-139">In questo modo è possibile definire più indici nella stessa colonna, velocizzando le operazioni con regole di confronto diverse, ad esempio i confronti con distinzione tra maiuscole e minuscole e senza distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="882d0-139">This allows multiple indexes to be defined on the same column, speeding up operations with different collations (e.g. both case-sensitive and case-insensitive comparisons).</span></span> <span data-ttu-id="882d0-140">Per ulteriori informazioni, consultare la documentazione del provider di database.</span><span class="sxs-lookup"><span data-stu-id="882d0-140">Consult your database provider's documentation for more details.</span></span>

> [!WARNING]
> <span data-ttu-id="882d0-141">Controllare sempre i piani di query delle query e verificare che gli indici corretti vengano usati nelle query critiche per le prestazioni in esecuzione su grandi quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="882d0-141">Always inspect the query plans of your queries, and make sure the proper indexes are being used in performance-critical queries executing over large amounts of data.</span></span> <span data-ttu-id="882d0-142">L'override della distinzione tra maiuscole e minuscole in una query tramite `EF.Functions.Collate` (o chiamando `string.ToLower` ) può avere un impatto significativo sulle prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="882d0-142">Overriding case-sensitivity in a query via `EF.Functions.Collate` (or by calling `string.ToLower`) can have a very significant impact on your application's performance.</span></span>

## <a name="translation-of-built-in-net-string-operations"></a><span data-ttu-id="882d0-143">Conversione di operazioni di stringa .NET predefinite</span><span class="sxs-lookup"><span data-stu-id="882d0-143">Translation of built-in .NET string operations</span></span>

<span data-ttu-id="882d0-144">Per impostazione predefinita, in .NET l'uguaglianza di stringhe fa distinzione tra maiuscole e minuscole: `s1 == s2` esegue un confronto ordinale che richiede che le stringhe siano identiche.</span><span class="sxs-lookup"><span data-stu-id="882d0-144">In .NET, string equality is case-sensitive by default: `s1 == s2` performs an ordinal comparison that requires the strings to be identical.</span></span> <span data-ttu-id="882d0-145">Poiché le regole di confronto predefinite dei database variano e, poiché è auspicabile un'uguaglianza semplice per l'utilizzo degli indici, EF Core non tenta di convertire l'uguaglianza semplice in un'operazione con distinzione tra maiuscole e minuscole nel database: l'uguaglianza di C# viene convertita direttamente nell'uguaglianza SQL, che può o meno fare distinzione tra maiuscole e minuscole, a seconda del database specifico in uso e</span><span class="sxs-lookup"><span data-stu-id="882d0-145">Because the default collation of databases varies, and because it is desirable for simple equality to use indexes, EF Core makes no attempt to translate simple equality to a database case-sensitive operation: C# equality is translated directly to SQL equality, which may or may not be case-sensitive, depending on the specific database in use and its collation configuration.</span></span>

<span data-ttu-id="882d0-146">Inoltre, .NET fornisce overload di [`string.Equals`](/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) accettazione di un' [`StringComparison`](/dotnet/api/system.stringcomparison) enumerazione, che consente di specificare la distinzione tra maiuscole e minuscole e le impostazioni cultura per il confronto.</span><span class="sxs-lookup"><span data-stu-id="882d0-146">In addition, .NET provides overloads of [`string.Equals`](/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) accepting a [`StringComparison`](/dotnet/api/system.stringcomparison) enum, which allows specifying case-sensitivity and culture for the comparison.</span></span> <span data-ttu-id="882d0-147">Per impostazione predefinita, EF Core si evita di tradurre questi overload in SQL e il tentativo di usarli comporta un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="882d0-147">By design, EF Core refrains from translating these overloads to SQL, and attempting to use them will result in an exception.</span></span> <span data-ttu-id="882d0-148">Per una cosa, EF Core non conosce quali regole di confronto con distinzione tra maiuscole e minuscole o senza distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="882d0-148">For one thing, EF Core does know not which case-sensitive or case-insensitive collation should be used.</span></span> <span data-ttu-id="882d0-149">Ancora più importante, l'applicazione di regole di confronto nella maggior parte dei casi impedisce l'utilizzo di indici, influire significativamente sulle prestazioni per un costrutto .NET molto semplice e di uso comune.</span><span class="sxs-lookup"><span data-stu-id="882d0-149">More importantly, applying a collation would in most cases prevent index usage, significantly impacting performance for a very basic and commonly-used .NET construct.</span></span> <span data-ttu-id="882d0-150">Per forzare una query a usare il confronto tra maiuscole e minuscole o senza distinzione tra maiuscole e minuscole, specificare le regole di confronto in modo esplicito tramite, `EF.Functions.Collate` come [descritto](#explicit-collations-and-indexes)</span><span class="sxs-lookup"><span data-stu-id="882d0-150">To force a query to use case-sensitive or case-insensitive comparison, specify a collation explicitly via `EF.Functions.Collate` as [detailed above](#explicit-collations-and-indexes).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="882d0-151">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="882d0-151">Additional resources</span></span>

### <a name="database-specific-information"></a><span data-ttu-id="882d0-152">Informazioni specifiche del database</span><span class="sxs-lookup"><span data-stu-id="882d0-152">Database-specific information</span></span>

* <span data-ttu-id="882d0-153">[SQL Server documentazione sulle regole di confronto](/sql/relational-databases/collations/collation-and-unicode-support).</span><span class="sxs-lookup"><span data-stu-id="882d0-153">[SQL Server documentation on collations](/sql/relational-databases/collations/collation-and-unicode-support).</span></span>
* <span data-ttu-id="882d0-154">[Documentazione di Microsoft. Data. sqlite sulle regole di confronto](/dotnet/standard/data/sqlite/collation).</span><span class="sxs-lookup"><span data-stu-id="882d0-154">[Microsoft.Data.Sqlite documentation on collations](/dotnet/standard/data/sqlite/collation).</span></span>
* <span data-ttu-id="882d0-155">[Documentazione di PostgreSQL sulle regole di confronto](https://www.postgresql.org/docs/current/collation.html).</span><span class="sxs-lookup"><span data-stu-id="882d0-155">[PostgreSQL documentation on collations](https://www.postgresql.org/docs/current/collation.html).</span></span>
* <span data-ttu-id="882d0-156">[Documentazione di MySQL sulle regole di confronto](https://dev.mysql.com/doc/refman/en/charset-general.html).</span><span class="sxs-lookup"><span data-stu-id="882d0-156">[MySQL documentation on collations](https://dev.mysql.com/doc/refman/en/charset-general.html).</span></span>

### <a name="other-resources"></a><span data-ttu-id="882d0-157">Altre risorse</span><span class="sxs-lookup"><span data-stu-id="882d0-157">Other resources</span></span>

* <span data-ttu-id="882d0-158">[EF Core sessione della community standup](https://www.youtube.com/watch?v=OgMhLVa_VfA&list=PLdo4fOcmZ0oX-DBuRG4u58ZTAJgBAeQ-t&index=1), introducendo regole di confronto ed esplorando gli aspetti delle prestazioni e dell'indicizzazione.</span><span class="sxs-lookup"><span data-stu-id="882d0-158">[EF Core Community Standup session](https://www.youtube.com/watch?v=OgMhLVa_VfA&list=PLdo4fOcmZ0oX-DBuRG4u58ZTAJgBAeQ-t&index=1), introducing collations and exploring perf and indexing aspects.</span></span>
